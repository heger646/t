<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Draw</title>
<style>
  body { margin:0; background:#222; color:#eee; font-family:sans-serif; }
  canvas { display:block; margin:0 auto; background:#fff; }
  .toolbar { display:flex; gap:10px; padding:10px; background:#333; }
  button { padding:5px 10px; cursor:pointer; }
</style>
</head>
<body>
<div class="toolbar">
  <button id="saveServer">Save to Server</button>
</div>
<canvas id="c" width="800" height="600"></canvas>

<script>
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
ctx.fillStyle = '#fff';
ctx.fillRect(0,0,canvas.width,canvas.height);

let drawing = false;
canvas.addEventListener('mousedown', e => { drawing=true; ctx.beginPath(); ctx.moveTo(e.offsetX,e.offsetY); });
canvas.addEventListener('mousemove', e => { if(drawing){ ctx.lineTo(e.offsetX,e.offsetY); ctx.stroke(); } });
canvas.addEventListener('mouseup', e => { drawing=false; });

document.getElementById('saveServer').addEventListener('click', async () => {
    const dataUrl = canvas.toDataURL('image/png');
    const res = await fetch('/save_png', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({image: dataUrl})
    });
    if(res.ok){
        const {url} = await res.json();
        alert('Saved to server: ' + url);
        window.open(url,'_blank');
    } else alert('Failed to save on server');
});
</script>
</body>
</html>
